# **üîπ Alembic: Database Migrations with SQLAlchemy**

## **üîπ What is Alembic?**

Alembic is a **database migration tool** for SQLAlchemy. It helps in:

‚úÖ **Version-controlling database schema changes**

‚úÖ **Rolling back and upgrading database versions**

‚úÖ **Handling schema updates without losing data**

---

## **üîπ Installing Alembic**

```bash
pip install alembic
```

---

## **1Ô∏è‚É£ Setting Up Alembic**

### **Initialize Alembic in Your Project**

Run the following command in your project directory:

```bash
alembic init alembic
```

This creates a folder structure like:

```
/alembic
  /versions       # Stores migration scripts
  env.py          # Config file for migrations
alembic.ini       # Main Alembic configuration file
```

---

## **2Ô∏è‚É£ Configuring the Database URL**

Edit `alembic.ini` and set your database URL:

```ini
sqlalchemy.url = sqlite:///test.db
```

For MySQL:

```ini
sqlalchemy.url = mysql+pymysql://user:password@localhost/dbname
```

For PostgreSQL:

```ini
sqlalchemy.url = postgresql://user:password@localhost/dbname
```

---

## **3Ô∏è‚É£ Creating a Migration Script**

If you have defined a model using SQLAlchemy ORM:

```python
from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import declarative_base

Base = declarative_base()

class User(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String(50))
    email = Column(String(100), unique=True)
```

Generate a migration file:

```bash
alembic revision --autogenerate -m "Initial migration"
```

This creates a file inside `alembic/versions/` with an autogenerated schema update.

---

## **4Ô∏è‚É£ Running Migrations**

Apply migrations to the database:

```bash
alembic upgrade head
```

‚úÖ **Why Use `upgrade head`?**

* Applies the latest migrations to the database.

---

## **5Ô∏è‚É£ Rolling Back Changes**

To  **undo the last migration** :

```bash
alembic downgrade -1
```

To  **reset to a specific version** , find the version ID inside `alembic/versions/` and run:

```bash
alembic downgrade <version_id>
```

‚úÖ **Why Use Rollback?**

* Reverts unintended schema changes  **without data loss** .

---

## **6Ô∏è‚É£ Manually Editing Migration Files**

A migration file looks like this:

```python
from alembic import op
import sqlalchemy as sa

# Migration identifier
revision = '123456789abc'
down_revision = None  # Change this for dependent migrations
branch_labels = None
depends_on = None

def upgrade():
    op.create_table(
        'users',
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('name', sa.String(50)),
        sa.Column('email', sa.String(100), unique=True)
    )

def downgrade():
    op.drop_table('users')
```

‚úÖ **Why Edit Manually?**

* Fine-tune column types, constraints, or dependencies.

---

## **üîπ Interview Questions on Alembic**

### **1Ô∏è‚É£ Basic Questions**

‚úî What is Alembic, and why is it used?

‚úî How do you initialize Alembic in a project?

‚úî How do you create and apply a migration?

### **2Ô∏è‚É£ Advanced Questions**

‚úî What is `--autogenerate`, and when should you use it?

‚úî How do you handle Alembic migrations in a production environment?

‚úî How do you manage database rollbacks effectively?

‚úî What is the difference between `upgrade` and `downgrade`?

---

## **üöÄ Next Steps**

Would you like an **Alembic + FastAPI example?** üéØ
